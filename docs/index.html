<html>
<head>
	<title>FGT AWS</title>
	<link rel="icon" href="favicon.ico" type="image/x-icon"/>

	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js" integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E=" crossorigin="anonymous"></script>
	<script src="networks.js"></script>

	<link rel="stylesheet" href="document.css"/>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css"/>
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Roboto:wght@300&display=swap" rel="stylesheet">

	<script>
		var configuring_device = 1;

		function switch_device() {
			configuring_device = $(this).val();

			if (configuring_device == 1) {
				$('#config-intrazone-nics-second').hide()
				$('#config-intrazone-nics-first').show()
				$('#config-intrazone-ec2-second').hide()
				$('#config-intrazone-ec2-first').show()
				$('#config-intrazone-fgt-second').hide()
				$('#config-intrazone-fgt-first').show()
			} else {
				$('#config-intrazone-nics-first').hide()
				$('#config-intrazone-nics-second').show()
				$('#config-intrazone-ec2-first').hide()
				$('#config-intrazone-ec2-second').show()
				$('#config-intrazone-fgt-first').hide()
				$('#config-intrazone-fgt-second').show()
			}

			$('input[data-type=deviceSelector]').each(function(index, element) {
				if ($(element).val() == configuring_device) {
					$(element).prop("checked", true);
				} else {
					$(element).prop("checked", false);
				}
			});
		}

		function generate_vpc_config() {
			let ip   = IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=vpcNetwork]').val());
			let mask = IPv4_cidr_to_number($('#config-intrazone-vpc input[type=text][name=vpcMask]').val());
			let external = IPv4_number_to_string((ip&mask)+IPv4_string_to_number("0.0.1.0"));
			let internal = IPv4_number_to_string((ip&mask)+IPv4_string_to_number("0.0.2.0"));
			let ha       = IPv4_number_to_string((ip&mask)+IPv4_string_to_number("0.0.3.0"));
			let mgmt     = IPv4_number_to_string((ip&mask)+IPv4_string_to_number("0.0.4.0"));

			$('#config-intrazone-vpc input[type=text][name=externalNetwork]').val(external);
			$('#config-intrazone-vpc input[type=text][name=internalNetwork]').val(internal);
			$('#config-intrazone-vpc input[type=text][name=haNetwork]').val(ha);
			$('#config-intrazone-vpc input[type=text][name=mgmtNetwork]').val(mgmt);
			$('#config-intrazone-vpc input[type=text][name=externalMask]').val("24");
			$('#config-intrazone-vpc input[type=text][name=internalMask]').val("24");
			$('#config-intrazone-vpc input[type=text][name=haMask]').val("24");
			$('#config-intrazone-vpc input[type=text][name=mgmtMask]').val("24");
		}

		function generate_nics_config() {
			// first device
			let port1primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=externalNetwork]').val())+4);
			let port1secondary = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=externalNetwork]').val())+6);
			let port2primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=internalNetwork]').val())+4);
			let port2secondary = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=internalNetwork]').val())+6);
			let port3primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=haNetwork]').val())+4);
			let port4primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=mgmtNetwork]').val())+4);

			$('#config-intrazone-nics-first input[type=text][name=port1PrimaryIp]').val(port1primary);
			$('#config-intrazone-nics-first input[type=text][name=port1SecondaryIp]').val(port1secondary);
			$('#config-intrazone-nics-first input[type=text][name=port2PrimaryIp]').val(port2primary);
			$('#config-intrazone-nics-first input[type=text][name=port2SecondaryIp]').val(port2secondary);
			$('#config-intrazone-nics-first input[type=text][name=port3PrimaryIp]').val(port3primary);
			$('#config-intrazone-nics-first input[type=text][name=port4PrimaryIp]').val(port4primary);

			$('#config-intrazone-ec2-first input[type=text][name=port1PrimaryIp]').val(port1primary);
			$('#config-intrazone-ec2-first input[type=text][name=port1SecondaryIp]').val(port1secondary);

			// second device
			port1primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=externalNetwork]').val())+5);
			port1secondary = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=externalNetwork]').val())+6);
			port2primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=internalNetwork]').val())+5);
			port2secondary = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=internalNetwork]').val())+6);
			port3primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=haNetwork]').val())+5);
			port4primary   = IPv4_number_to_string(IPv4_string_to_number($('#config-intrazone-vpc input[type=text][name=mgmtNetwork]').val())+5);

			$('#config-intrazone-nics-second input[type=text][name=port1PrimaryIp]').val(port1primary);
			$('#config-intrazone-nics-second input[type=text][name=port1SecondaryIp]').val(port1secondary);
			$('#config-intrazone-nics-second input[type=text][name=port2PrimaryIp]').val(port2primary);
			$('#config-intrazone-nics-second input[type=text][name=port2SecondaryIp]').val(port2secondary);
			$('#config-intrazone-nics-second input[type=text][name=port3PrimaryIp]').val(port3primary);
			$('#config-intrazone-nics-second input[type=text][name=port4PrimaryIp]').val(port4primary);

			$('#config-intrazone-ec2-second input[type=text][name=port1PrimaryIp]').val(port1primary);
			$('#config-intrazone-ec2-second input[type=text][name=port1SecondaryIp]').val(port1secondary);
		}

		function generate_intrazone_config() {
			let config = "";

			// this is used for selectors where we need to use the right one
			let thisDeviceSuffix  = "first";
			let otherDeviceSuffix = "second";
			if (configuring_device == 2) {
				thisDeviceSuffix  = "second";
				otherDeviceSuffix = "first";
			}

			// get values and check for errors
			let hostname      = $('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=text][name=hostname]').val();
			let admintimeout  = $('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=text][name=admintimeout]').val();
			let timezone      = $('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=text][name=timezone]').val();

			let port1Ip = $('#config-intrazone-nics-'+thisDeviceSuffix+' input[type=text][name=port1SecondaryIp]').val();
			let port2Ip = $('#config-intrazone-nics-'+thisDeviceSuffix+' input[type=text][name=port2SecondaryIp]').val();
			let port3Ip = $('#config-intrazone-nics-'+thisDeviceSuffix+' input[type=text][name=port3PrimaryIp]').val();
			let port4Ip = $('#config-intrazone-nics-'+thisDeviceSuffix+' input[type=text][name=port4PrimaryIp]').val();
			let port1Mask = $('#config-intrazone-vpc input[type=text][name=externalMask]').val();
			let port2Mask = $('#config-intrazone-vpc input[type=text][name=internalMask]').val();
			let port3Mask = $('#config-intrazone-vpc input[type=text][name=haMask]').val();
			let port4Mask = $('#config-intrazone-vpc input[type=text][name=mgmtMask]').val();

			let haPriority = $('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=text][name=ha-priority]').val();
			let haPeer     =  $('#config-intrazone-nics-'+otherDeviceSuffix+' input[type=text][name=port3PrimaryIp]').val();


			let errors = "";
			if (port1Ip.length == 0 || port1Ip == "0.0.0.0") errors += "- Port1 secondary IP address missing.\n";
			if (port2Ip.length == 0 || port2Ip == "0.0.0.0") errors += "- Port2 secondary IP address missing.\n";
			if (port3Ip.length == 0 || port3Ip == "0.0.0.0") errors += "- Port3 primary IP address missing.\n";
			if (port4Ip.length == 0 || port4Ip == "0.0.0.0") errors += "- Port4 primary IP address missing.\n";

			if (errors.length > 0) {
				errors = "Cannot generate config file because of following errors:\n\n" + errors;
				alert(errors);
				return false;
			}


			// global settings
			config += 'config system global\n';
			if (hostname.length > 0) {
			config += '    set hostname '        + hostname + "\n";
			}
			if (admintimeout.length > 0) {
			config += '    set admintimeout '    + admintimeout + "\n";
			}
			if (timezone.length > 0) {
			config += '    set timezone '        + timezone + "\n";
			}
			config += 'end\n';
			config += '\n';
			
			// interfaces
			config += 'config system interface\n';
			config += '    edit port1\n';
			config += '        set mode static\n';
			config += '        set ip ' + port1Ip + '/' + port1Mask + "\n";
			config += '        set allowaccess ping ssh\n';
			config += '        set alias external\n';
			config += '    next\n';
			config += '    edit port2\n';
			config += '        set mode static\n';
			config += '        set ip ' + port2Ip + '/' + port2Mask + "\n";
			config += '        set allowaccess ping\n';
			config += '        set alias internal\n';
			config += '    next\n';
			config += '    edit port3\n';
			config += '        set mode static\n';
			config += '        set ip ' + port3Ip + '/' + port3Mask + "\n";
			config += '        set allowaccess ping\n';
			config += '        set alias ha\n';
			config += '    next\n';
			config += '    edit port4\n';
			config += '        set mode static\n';
			config += '        set ip ' + port4Ip + '/' + port4Mask + "\n";
			config += '        set allowaccess ping ssh https\n';
			config += '        set alias management\n';
			config += '    next\n';
			config += 'end\n';
			config += '\n';

			// routing
			if ($('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=checkbox][name=default-route-port1]').is(':checked')) {
				let ip   = IPv4_string_to_number(port1Ip);
				let mask = IPv4_cidr_to_number(port1Mask);
				let dgw  = IPv4_number_to_string((ip&mask)+1);

				config += 'config router static\n';
				config += '    edit 0\n';
				config += '        set device port1\n';
				config += '        set gateway ' + dgw + '\n';
				config += '    next\n';
				config += 'end\n';
				config += '\n';
			}

			// ha
			config += 'config system ha\n';
			config += '    set group-name "fgtha"\n';
			config += '    set mode a-p\n';
			config += '    set password topsecret\n';
			config += '    set hbdev "port3" 50\n';
			config += '    set ha-mgmt-status enable\n';
			config += '    config ha-mgmt-interfaces\n';
			config += '        edit 0\n';
			config += '            set interface "port4"\n';
			config += '        next\n';
			config += '    end\n';
			config += '    set override enable\n';
			config += '    set priority ' + haPriority + "\n";
			config += '    set unicast-hb enable\n';
			config += '    set unicast-hb-peerip ' + haPeer + "\n";
			config += 'end\n';
			config += '\n';

			// ipsec configuration
			if ($('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=checkbox][name=ipsec]').is(':checked')) {
				// local user
				config += 'config user local\n';
				config += '    edit "client"\n';
				config += '        set type password\n';
				config += '        set passwd "' + $('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=text][name=ipsec-client-password]').val() + '"\n';
				config += '    next\n';
				config += 'end\n';
				config += '\n';
				// local user group
				config += 'config user group\n';
				config += '    edit "vpnclients"\n';
				config += '        set member "client"\n';
				config += '    next\n';
				config += 'end\n';
				config += '\n';
				// phase 1
				config += 'config vpn ipsec phase1-interface\n';
				config += '    edit "clients"\n';
				config += '        set type dynamic\n';
				config += '        set interface "port1"\n';
				config += '        set mode aggressive\n';
				config += '        set peertype any\n';
				config += '        set mode-cfg enable\n';
				config += '        set localid "fgtaws"\n';
				config += '        set xauthtype auto\n';
				config += '        set authusrgrp "vpnclients"\n';
				config += '        set ipv4-start-ip 169.254.111.2\n';
				config += '        set ipv4-end-ip 169.254.111.254\n';
				config += '        set psksecret "' + $('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=text][name=ipsec-psk]').val() + '"\n';
				config += '    next\n';
				config += 'end\n';
				config += '\n';
				// phase 2
				config += 'config vpn ipsec phase2-interface\n';
				config += '    edit "clients"\n';
				config += '        set phase1name "clients"\n';
				config += '        set keepalive enable\n';
				config += '    next\n';
				config += 'end\n';
				config += '\n';
			}

			// firewall policies
			if ($('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=checkbox][name=policy-default]').is(':checked')) {
				config += 'config firewall policy\n';

				config += '    edit 0\n';
				config += '        set name "default from internal to external"\n';
				config += '        set srcintf "port2"\n';
				config += '        set dstintf "port1"\n';
				config += '        set srcaddr "all"\n';
				config += '        set dstaddr "all"\n';
				config += '        set action accept\n';
				config += '        set schedule "always"\n';
				config += '        set service "ALL"\n';
				config += '        set nat enable\n';
				config += '    next\n';

				if ($('#config-intrazone-fgt-'+thisDeviceSuffix+' input[type=checkbox][name=ipsec]').is(':checked')) {
					config += '    edit 0\n';
					config += '        set name "ipsec from external to internal"\n';
					config += '        set srcintf "clients"\n';
					config += '        set dstintf "port2"\n';
					config += '        set srcaddr "all"\n';
					config += '        set dstaddr "all"\n';
					config += '        set action accept\n';
					config += '        set schedule "always"\n';
					config += '        set service "ALL"\n';
					config += '        set nat enable\n';
					config += '    next\n';
				}

				config += 'end\n';
				config += '\n'
			}

			config = config.trimEnd()+"\n";
			$('#dialog-userdata textarea[name=config]').text(config);
			return true;
		}

		function generate_default_config() {
			$('#config-intrazone-vpc input[type=text][name=vpcNetwork]').val("10.0.0.0");
			$('#config-intrazone-vpc input[type=text][name=vpcMask]').val("16");

			generate_vpc_config();
			generate_nics_config();
			generate_intrazone_config();
		}

		function switch_section_ipsec(e) {
			if ($(e.target).is(':checked')) {
				$('#config-intrazone-fgt-first input[name=ipsec-psk]').parents('tr').first().show(500);
				$('#config-intrazone-fgt-first input[name=ipsec-client-password]').parents('tr').first().show(500);
			} else {
				$('#config-intrazone-fgt-first input[name=ipsec-psk]').parents('tr').first().hide(500);
				$('#config-intrazone-fgt-first input[name=ipsec-client-password]').parents('tr').first().hide(500);
			}
		}

		function onload() {
			$('#config-intrazone-vpc  input[type=button][name=generate]').click(generate_vpc_config);
			$('#config-intrazone-nics-first  input[type=button][name=generate]').click(generate_nics_config);
			$('#config-intrazone-nics-second input[type=button][name=generate]').click(generate_nics_config);
			$('#config-intrazone-ec2-first  input[type=button][name=generate]').click(generate_nics_config);
			$('#config-intrazone-ec2-second input[type=button][name=generate]').click(generate_nics_config);
			$('input[data-type=deviceSelector]').change(switch_device);
			$('#config-intrazone-fgt-first  input[type=button][name=generate]').click(function() {
				generate_intrazone_config() && $('#dialog-userdata').dialog({resizable: false, modal: true, height:'auto', width:'auto', position: {my: 'center', at: 'center', of: window}});
			});
			$('#config-intrazone-fgt-second input[type=button][name=generate]').click(function() {
				generate_intrazone_config() && $('#dialog-userdata').dialog({resizable: false, modal: true, height:'auto', width:'auto', position: {my: 'center', at: 'center', of: window}});
			});

			$('#config-intrazone-fgt-first input[type=checkbox][name=ipsec]').change(switch_section_ipsec);
		}
	</script>
</head>
<body onload="onload()">
	<div id="main-content">
	<h1>FortiGate native same-zone A-P HA in AWS</h1>

	<div name="manual-intrazone-step-vpc">
		<h2>&#8227; Create VPC configuration</h2>
		<div name="indent1">
			<h3 class="step">Create VPC with specified IP range and 4 subnets with IP ranges from the VPC range.</h3>
	
			<p>Make sure you explicitly select the same "Availablity zone" when creating the subnets.</p>
	
			<table id="config-intrazone-vpc">
				<tr><td>VPC address range:</td><td><input type="text" name="vpcNetwork" value="10.0.0.0"/> / <input type="text" name="vpcMask" value="16" readonly size="2"/></td><tr>
				<tr><td colspan="2"><input type="button" name="generate" value="Generate subnets configuration"/></td></tr>
				<tr><td>External subnet:</td><td><input type="text" name="externalNetwork" value=""/> / <input type="text" name="externalMask" value="24" size="2"/></td><tr>
				<tr><td>Internal subnet:</td><td><input type="text" name="internalNetwork" value=""/> / <input type="text" name="internalMask" value="24" size="2"/></td><tr>
				<tr><td>HA subnet:</td><td><input type="text" name="haNetwork" value=""/> / <input type="text" name="haMask" value="24" size="2"/></td><tr>
				<tr><td>Management subnet:</td><td><input type="text" name="mgmtNetwork" value=""/> / <input type="text" name="mgmtMask" value="24" size="2"/></td><tr>
			</table><br/>
	
			<h3 class="step">Create Internet gateway and attach it to VPC.</h3>
			<p class="note">This will allow future public IPs to be reachable correctly.</p>
	
			<h3 class="step">Create new routing table and attach it to external subnet.</h3>
			<p>In the routing table create new with destination "0.0.0.0/0" routed via VPC Internet gateway.</p>
			<p class="note">This is necessary for the shared public IP that will be attached later.</p>
	
			<h3 class="step">Create new routing table and attach it to management subnet.</h3>
			<p>In the routing table create new with destination "0.0.0.0/0" routed via VPC Internet gateway.</p>
			<p class="note">This is necessary for the management public IP that will be attached later.</p>
	
			<h3 class="step">Create 3 new Elastic (public) IP addresses.</h3>
			<p>Create but do not attach them yet.</p>
			<ol>
			<li>Shared by FortiGates and always pointing to actual master's port1 ("external") interface.
			<li>First FortiGate management always pointing to its port4 ("management") interface.
			<li>Second FortiGate management always pointing to its port4 ("management") interface.
			</ol>
		</div>

		<h2>&#8227; Create additional network interfaces</h2>
		<div name="indent1">
			<input type="radio" id="config-intrazone-nics-selected-device1" name="config-intrazone-nics-selected-device" data-type="deviceSelector" value="1" checked>
			<label for="config-intrazone-nics-selected-device1">First FortiGate</label>
			<input type="radio" id="config-intrazone-nics-selected-device2" name="config-intrazone-nics-selected-device" data-type="deviceSelector" value="2">
			<label for="config-intrazone-nics-selected-device2">Second FortiGate</label>

			<p class="note">This is necessary because when deploying new VM via AWS console,
			                max 2 NICs can be specified but we need 4.
			</p>
			<p class="note">We explicitly create NICs for port2, port3 and port4. Interface port1
			                will be created later by AWS when deploying the VM. Its value is shown
			                here just for overview.
			</p>

			<table id="config-intrazone-nics-first">
				<tr><td colspan="2"><input type="button" name="generate" value="Generate IPs from subnets"/></td></tr>
				<tr class="disabled"><td>Port1 ("external") primary IP:</td><td><input type="text" name="port1PrimaryIp" value=""/></td></tr>
				<tr class="disabled"><td>Port1 ("external") secondary IP:</td><td><input type="text" name="port1SecondaryIp" value=""/></td></tr>
				<tr><td>Port2 ("internal") primary IP:</td><td><input type="text" name="port2PrimaryIp" value=""/></td></tr>
				<tr><td>Port2 ("internal") secondary IP:</td><td><input type="text" name="port2SecondaryIp" value=""/></td></tr>
				<tr><td>Port3 ("ha") primary IP:</td><td><input type="text" name="port3PrimaryIp" value=""/></td></tr>
				<tr><td>Port4 ("management") primary IP:</td><td><input type="text" name="port4PrimaryIp" value=""/></td></tr>
			</table>

			<script>
				original = $('#config-intrazone-nics-first');
				clone = original.clone();
				clone.attr("id", "config-intrazone-nics-second");
				clone.insertAfter(original);
			</script>
		</div>

		<h2>&#8227; Create new VM (EC2 instance)</h2>
		<div name="indent1">
			<input type="radio" id="config-intrazone-ec2-selected-device1" name="config-intrazone-ec2-selected-device" data-type="deviceSelector" value="1" checked>
			<label for="config-intrazone-ec2-selected-device1">First FortiGate</label>
			<input type="radio" id="config-intrazone-ec2-selected-device2" name="config-intrazone-ec2-selected-device" data-type="deviceSelector" value="2">
			<label for="config-intrazone-ec2-selected-device2">Second FortiGate</label>

			<p>Important stuff to specify:
			<ul>
			<li>Specify the <a href="javascript:$('#dialog-iam-role-unicast-ha').dialog({resizable: false, modal: true, height:'auto', width:'auto', position: {my: 'center', at: 'center', of: window}})">right IAM role</a>
			    with privileges to update networking configuration of EC2 instances.  In Fortinet EMEA TAC account the role name is "FortiOS_unicast_HA".
			</li>
			<li>Select the right VPC name and because AWS will create port1, select the subnet "external".</li>
			</ul>

			<table id="config-intrazone-ec2-first">
				<tr><td colspan="2"><input type="button" name="generate" value="Generate IPs from subnets"/></td></tr>
				<tr><td>Port1 ("external") primary IP:</td><td><input type="text" name="port1PrimaryIp" value=""/></td></tr>
				<tr><td>Port1 ("external") secondary IP:</td><td><input type="text" name="port1SecondaryIp" value=""/></td></tr>
			</table>

			<table id="config-intrazone-ec2-second">
				<tr><td colspan="2"><input type="button" name="generate" value="Generate IPs from subnets"/></td></tr>
				<tr><td>Port1 ("external") primary IP:</td><td><input type="text" name="port1PrimaryIp" value=""/></td></tr>
				<tr><td>Port1 ("external") secondary IP:</td><td><input type="text" name="port1SecondaryIp" value=""/></td></tr>
			</table>

			<h3>User data (preload configuration)</h3>
			<p>Make sure that the IP fields above are filled correctly or it will not work!</p>

			<table id="config-intrazone-fgt-first">
				<tr><td>Hostname:</td><td><input type="text" name="hostname" value="awsfgt1"/></td><tr>
				<tr><td>Admin timeout:</td><td><input type="text" name="admintimeout" value="480"/></td><tr>
				<tr><td>Timezone:</td><td><input type="text" name="timezone" value="27"/></td><tr>
				<tr><td>Create default firewall policy from port2 to port1:</td><td><input type="checkbox" name="policy-default" checked/></td><tr>
				<tr><td>Create default route through port1:</td><td><input type="checkbox" name="default-route-port1" checked/></td><tr>
				<tr><td>Create IPSec VPN responder configuration:</td><td><input type="checkbox" name="ipsec" checked/></td><tr>
				<tr><td>IPSec preshared secret:</td><td><input type="text" name="ipsec-psk" value="FortiAws99!"/></td><tr>
				<tr><td>IPSec XAUTH "client" password:</td><td><input type="text" name="ipsec-client-password" value="client"/></td><tr>
		
				<tr><td>HA priority:</td><td><input type="text" name="ha-priority" value="200"/></td><tr>
		
				<tr><td colspan="2"><input type="button" name="generate" value="Generate config script"/></td></tr>
			</table>

			<script>
				original = $('#config-intrazone-fgt-first');
				clone = original.clone();
				clone.attr("id", "config-intrazone-fgt-second");
				clone.find('input[type=text][name=hostname]').val("awsfgt2");
				clone.find('input[type=text][name=ha-priority]').val("100");
				clone.insertAfter(original);
			</script>

		</div>
	</div>
	</div>


<!-- Additional divs that have special meaning - like dialogs etc. -->

<div id="dialog-userdata" title="User data field contents">
	<textarea name="config"></textarea>
</div>

<div id="dialog-iam-role-unicast-ha" title="IAM role for FortiGate unicast HA">
<pre>
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ec2:Describe*",
                "ec2:UnassignPrivateIpAddresses",
                "ec2:AssignPrivateIpAddresses",
                "ec2:AssociateAddress",
                "ec2:ReplaceRoute",
                "eks:ListClusters"
            ],
            "Resource": "*"
        }
    ]
}
</pre>
</div>

<div id="static-buttons">
	<fieldset>
		<legend>Global actions:</legend>
		<input type="button" value="Fill all default values" onclick="generate_default_config()"/>
	</fieldset>
</div>
</body>
</html>
